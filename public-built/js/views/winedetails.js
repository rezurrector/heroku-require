define(["jquery","underscore","backbone","utils","text!WineViewTpl"],function(e,t,n,r,i){return n.View.extend({initialize:function(){this.render()},template:t.template(i),render:function(){return e(this.el).html(this.template(this.model.toJSON())),this},events:{change:"change","click .save":"beforeSave","click .delete":"deleteWine","drop #picture":"dropHandler"},change:function(e){r.hideAlert();var t=e.target,n={};n[t.name]=t.value,this.model.set(n);var i=this.model.validateItem(t.id);i.isValid===!1?r.addValidationError(t.id,i.message):r.removeValidationError(t.id)},beforeSave:function(){var e=this,t=this.model.validateAll();return t.isValid===!1?(r.displayValidationErrors(t.messages),!1):(this.saveWine(),!1)},saveWine:function(){var e=this;console.log("before save"),this.model.save(null,{success:function(t){e.render(),app.navigate("wines/"+t.id,!1),r.showAlert("Success!","Wine saved successfully","alert-success")},error:function(){r.showAlert("Error","An error occurred while trying to delete this item","alert-error")}})},deleteWine:function(){return this.model.destroy({success:function(){alert("Wine deleted successfully"),window.history.back()}}),!1},dropHandler:function(t){t.stopPropagation(),t.preventDefault();var n=t.originalEvent;n.dataTransfer.dropEffect="copy",this.pictureFile=n.dataTransfer.files[0];var r=new FileReader;r.onloadend=function(){e("#picture").attr("src",r.result)},r.readAsDataURL(this.pictureFile)}})});