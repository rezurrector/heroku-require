define("WineModel",["jquery","underscore","backbone"],function(e,t,n){return n.Model.extend({urlRoot:"/wines",idAttribute:"_id",initialize:function(){this.validators={},this.validators.name=function(e){return e.length>0?{isValid:!0}:{isValid:!1,message:"You must enter a name"}},this.validators.grapes=function(e){return e.length>0?{isValid:!0}:{isValid:!1,message:"You must enter a grape variety"}},this.validators.country=function(e){return e.length>0?{isValid:!0}:{isValid:!1,message:"You must enter a country"}}},validateItem:function(e){return this.validators[e]?this.validators[e](this.get(e)):{isValid:!0}},validateAll:function(){var e={};for(var n in this.validators)if(this.validators.hasOwnProperty(n)){var r=this.validators[n](this.get(n));r.isValid===!1&&(e[n]=r.message)}return t.size(e)>0?{isValid:!1,messages:e}:{isValid:!0}},defaults:{_id:null,name:"",grapes:"",country:"USA",region:"California",year:"",description:"",picture:null}})}),define("utils",["jquery"],function(e){return{displayValidationErrors:function(e){for(var t in e)e.hasOwnProperty(t)&&this.addValidationError(t,e[t]);this.showAlert("Warning!","Fix validation errors and try again","alert-warning")},addValidationError:function(t,n){var r=e("#"+t).parent().parent();r.addClass("error"),e(".help-inline",r).html(n)},removeValidationError:function(t){var n=e("#"+t).parent().parent();n.removeClass("error"),e(".help-inline",n).html("")},showAlert:function(t,n,r){e(".alert").removeClass("alert-error alert-warning alert-success alert-info"),e(".alert").addClass(r),e(".alert").html("<strong>"+t+"</strong> "+n),e(".alert").show()},hideAlert:function(){e(".alert").hide()}}}),define("text!WineViewTpl",[],function(){return'<div class="row-fluid">\n\n    <form class="form-horizontal span12">\n\n        <fieldset>\n\n            <legend>Wine Details</legend>\n            <br/>\n\n            <div class="row">\n                <div class="span8">\n\n                    <div class="control-group">\n                        <label for="wineId" class="control-label">Id:</label>\n\n                        <div class="controls">\n                            <input id="wineId" name="id" type="text" value="<%= _id === null ? \'\' : _id %>"\n                                   disabled/>\n                        </div>\n                    </div>\n\n                    <div class="control-group">\n                        <label for="name" class="control-label">Name:</label>\n\n                        <div class="controls">\n                            <input type="text" id="name" name="name" value="<%= name %>"/>\n                            <span class="help-inline"></span>\n                        </div>\n                    </div>\n\n                    <div class="control-group">\n                        <label for="grapes" class="control-label">Grapes:</label>\n\n                        <div class="controls">\n                            <input type="text" id="grapes" name="grapes" value="<%= grapes %>"/>\n                            <span class="help-inline"></span>\n                        </div>\n                    </div>\n\n                    <div class="control-group">\n                        <label for="country" class="control-label">Country:</label>\n\n                        <div class="controls">\n                            <input type="text" id="country" name="country" value="<%= country %>"/>\n                            <span class="help-inline"></span>\n                        </div>\n                    </div>\n\n                    <div class="control-group">\n                        <label for="region" class="control-label">Region:</label>\n\n                        <div class="controls">\n                            <input type="text" id="region" name="region" value="<%= region %>"/>\n                        </div>\n                    </div>\n\n                    <div class="control-group">\n                        <label for="year" class="control-label">Year:</label>\n\n                        <div class="controls">\n                            <select class="input-small" id="year" name="year" value="<%= year %>">\n                                <option\n                                <%= year == 2012?\'selected\':\'\' %>>2012</option>\n                                <option\n                                <%= year == 2011?\'selected\':\'\' %>>2011</option>\n                                <option\n                                <%= year == 2010?\'selected\':\'\' %>>2010</option>\n                                <option\n                                <%= year == 2009?\'selected\':\'\' %>>2009</option>\n                                <option\n                                <%= year == 2008?\'selected\':\'\' %>>2008</option>\n                                <option\n                                <%= year == 2007?\'selected\':\'\' %>>2007</option>\n                            </select>\n                        </div>\n                    </div>\n\n                    <div class="control-group">\n                        <label for="description" class="control-label">Notes:</label>\n\n                        <div class="controls">\n                            <textarea id="description" name="description" style="width: 90%;" rows="6"><%= description\n                                %></textarea>\n                        </div>\n                    </div>\n\n                </div>\n\n                <div class="span4">\n                    <div class="well" style="width: 180px;text-align: center;width:50%;margin: 0px auto;">\n                        <p><img id="picture" width="180" src="<%= picture === null ? \'pics/generic.jpg\' : \'pics/\' + picture %>"/></p>\n                        <p style="color:#999;">To change the picture, drag a new picture from your file system onto the box above.</p>\n                    </div>\n                </div>\n\n            </div>\n\n        </fieldset>\n\n        <div class="form-actions">\n            <a href="#" class="btn btn-primary save">Save</a>\n            <a href="#" class="btn delete">Delete</a>\n        </div>\n\n    </form>\n\n</div>\n\n<div class="row-fluid status-bar">\n    <div class="span12">\n        <div class="alert alert-success" style="display: none">\n            <b>Success!</b> Wine saved successfully\n        </div>\n    </div>\n</div>'}),define("WineView",["jquery","underscore","backbone","utils","text!WineViewTpl"],function(e,t,n,r,i){return n.View.extend({initialize:function(){this.render()},template:t.template(i),render:function(){return e(this.el).html(this.template(this.model.toJSON())),this},events:{change:"change","click .save":"beforeSave","click .delete":"deleteWine","drop #picture":"dropHandler"},change:function(e){r.hideAlert();var t=e.target,n={};n[t.name]=t.value,this.model.set(n);var i=this.model.validateItem(t.id);i.isValid===!1?r.addValidationError(t.id,i.message):r.removeValidationError(t.id)},beforeSave:function(){var e=this,t=this.model.validateAll();return t.isValid===!1?(r.displayValidationErrors(t.messages),!1):(this.saveWine(),!1)},saveWine:function(){var e=this;console.log("before save"),this.model.save(null,{success:function(t){e.render(),app.navigate("wines/"+t.id,!1),r.showAlert("Success!","Wine saved successfully","alert-success")},error:function(){r.showAlert("Error","An error occurred while trying to delete this item","alert-error")}})},deleteWine:function(){return this.model.destroy({success:function(){alert("Wine deleted successfully"),window.history.back()}}),!1},dropHandler:function(t){t.stopPropagation(),t.preventDefault();var n=t.originalEvent;n.dataTransfer.dropEffect="copy",this.pictureFile=n.dataTransfer.files[0];var r=new FileReader;r.onloadend=function(){e("#picture").attr("src",r.result)},r.readAsDataURL(this.pictureFile)}})}),define("routes/addview",["jquery","underscore","WineModel","WineView"],function(e,t,n,r){return{initView:function(t){var i=new n({_id:t}),s=e.Deferred(),o=s.then(function(){return(new r({model:i})).el});return i.fetch({success:function(){s.resolve()}}),o},initAdd:function(){return(new r({model:new n})).el}}});